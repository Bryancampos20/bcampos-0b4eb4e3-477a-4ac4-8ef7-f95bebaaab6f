<div class="min-h-screen bg-slate-900 text-slate-100 flex flex-col">
  <!-- Top bar -->
  <header class="flex items-center justify-between px-8 py-4 border-b border-slate-800 bg-slate-950/80">
    <div>
      <h1 class="text-xl font-semibold">Task Management</h1>
      <p class="text-xs text-slate-400 mt-1">
        Logged in as
        <span class="font-medium">{{ currentUser?.email }}</span>
        <span class="ml-1 px-2 py-0.5 rounded-full text-[10px] uppercase bg-slate-800 text-slate-300">
          {{ currentUser?.role }}
        </span>
      </p>
    </div>

    <button
      (click)="logout()"
      class="px-3 py-1.5 text-sm rounded-lg bg-slate-800 hover:bg-slate-700 border border-slate-700 transition"
    >
      Logout
    </button>
  </header>

  <!-- Main content -->
  <div class="flex-1 flex flex-col lg:flex-row gap-6 p-6">
    <!-- Tasks list -->
    <section class="flex-1 bg-slate-900 border border-slate-800 rounded-xl p-4 shadow-lg">
      <div class="flex items-center justify-between mb  -4">
        <h2 class="text-lg font-semibold">Tasks</h2>
        <span class="text-xs text-slate-400">
          {{ tasks.length }} task{{ tasks.length === 1 ? '' : 's' }}
        </span>
      </div>

      <div *ngIf="loading" class="text-sm text-slate-400 mt-4">
        Loading tasks…
      </div>

      <div *ngIf="error" class="text-sm text-red-400 mt-2">
        {{ error }}
      </div>

      <div *ngIf="!loading && tasks.length === 0" class="text-sm text-slate-400 mt-4">
        No tasks yet. Use the form on the right to create one.
      </div>

      <div class="mt-4 overflow-x-auto" *ngIf="tasks.length > 0">
        <table class="min-w-full text-sm border-collapse">
          <thead>
            <tr class="border-b border-slate-800 text-slate-400">
              <th class="text-left py-2 pr-4">Title</th>
              <th class="text-left py-2 pr-4">Category</th>
              <th class="text-left py-2 pr-4">Status</th>
              <th class="text-left py-2 pr-4 hidden md:table-cell">Description</th>
              <th class="text-right py-2 pl-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let task of tasks"
              class="border-b border-slate-800/60 hover:bg-slate-800/40 transition"
            >
              <td class="py-2 pr-4 align-top">
                <div class="font-medium">{{ task.title }}</div>
              </td>
              <td class="py-2 pr-4 align-top">
                <span class="px-2 py-0.5 rounded-full bg-slate-800 text-[11px]">
                  {{ task.category }}
                </span>
              </td>
              <td class="py-2 pr-4 align-top">
                <span
                  class="px-2 py-0.5 rounded-full text-[11px]"
                  [ngClass]="{
                    'bg-sky-800 text-sky-100': task.status === 'TODO',
                    'bg-amber-700 text-amber-50': task.status === 'IN_PROGRESS',
                    'bg-emerald-700 text-emerald-50': task.status === 'DONE'
                  }"
                >
                  {{ task.status }}
                </span>
              </td>
              <td class="py-2 pr-4 align-top hidden md:table-cell">
                <span class="text-slate-300 text-xs">
                  {{ task.description || '—' }}
                </span>
              </td>
              <td class="py-2 pl-4 align-top text-right">
                <ng-container *ngIf="canModifyTasks; else viewerActions">
                  <button
                    class="text-xs px-2 py-1 rounded-lg border border-slate-700 hover:bg-slate-800 mr-2"
                    (click)="startEdit(task)"
                  >
                    Edit
                  </button>
                  <button
                    class="text-xs px-2 py-1 rounded-lg border border-red-700 text-red-300 hover:bg-red-800/60"
                    (click)="deleteTask(task)"
                  >
                    Delete
                  </button>
                </ng-container>
                <ng-template #viewerActions>
                  <span class="text-[11px] text-slate-500 italic">
                    Read-only
                  </span>
                </ng-template>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Form -->
    <section class="w-full lg:w-80 bg-slate-900 border border-slate-800 rounded-xl p-4 shadow-lg">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">
          {{ editingTaskId ? 'Edit task' : 'Create task' }}
        </h2>
      </div>

      <div *ngIf="isViewer" class="text-xs text-slate-400 mb-2">
        You are signed in as <span class="font-medium">VIEWER</span>. Task creation
        and modifications are disabled.
      </div>

      <form (ngSubmit)="submitForm()" class="space-y-3" [class.opacity-60]="!canModifyTasks">
        <div>
          <label class="block text-xs font-medium text-slate-300 mb-1">Title</label>
          <input
            type="text"
            [(ngModel)]="formTitle"
            name="title"
            [disabled]="!canModifyTasks"
            class="w-full px-3 py-2 rounded-lg bg-slate-950 border border-slate-700 text-sm text-slate-100 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
            placeholder="Short task title"
            required
          />
        </div>

        <div>
          <label class="block text-xs font-medium text-slate-300 mb-1">Description</label>
          <textarea
            [(ngModel)]="formDescription"
            name="description"
            [disabled]="!canModifyTasks"
            rows="3"
            class="w-full px-3 py-2 rounded-lg bg-slate-950 border border-slate-700 text-sm text-slate-100 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 resize-none"
            placeholder="Optional description"
          ></textarea>
        </div>

        <div class="flex gap-2">
          <div class="flex-1">
            <label class="block text-xs font-medium text-slate-300 mb-1">Category</label>
            <input
              type="text"
              [(ngModel)]="formCategory"
              name="category"
              [disabled]="!canModifyTasks"
              class="w-full px-3 py-2 rounded-lg bg-slate-950 border border-slate-700 text-sm text-slate-100 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
              placeholder="e.g. WORK, HOME"
              required
            />
          </div>

          <div class="w-32">
            <label class="block text-xs font-medium text-slate-300 mb-1">Status</label>
            <select
              [(ngModel)]="formStatus"
              name="status"
              [disabled]="!canModifyTasks"
              class="w-full px-3 py-2 rounded-lg bg-slate-950 border border-slate-700 text-sm text-slate-100 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500"
            >
              <option value="TODO">TODO</option>
              <option value="IN_PROGRESS">IN_PROGRESS</option>
              <option value="DONE">DONE</option>
            </select>
          </div>
        </div>

        <div class="flex gap-2 pt-1">
          <button
            type="submit"
            [disabled]="!canModifyTasks"
            class="flex-1 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold text-white disabled:opacity-40 disabled:cursor-not-allowed transition"
          >
            {{ editingTaskId ? 'Save changes' : 'Create task' }}
          </button>

          <button
            type="button"
            (click)="resetForm()"
            class="px-3 py-2 rounded-lg border border-slate-700 text-sm text-slate-200 hover:bg-slate-800/70 transition"
          >
            Clear
          </button>
        </div>
      </form>
    </section>
  </div>
</div>
